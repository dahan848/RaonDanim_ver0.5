<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper     
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.raon.raondanim.dao.AccountsUserDAO">
	<insert id="setDnmmyData" parameterType="User">
	INSERT INTO USER_TB
			   (USER_NUM, USER_ID, USER_PW, USER_FNM, USER_LNM, USER_EMAIL_VERIFY , USER_REG_DATE)
		VALUES (
				USER_TB001_SEQ.nextval,
				#{user_id},
				#{user_pw},
				#{user_fnm},
				#{user_lnm},
				1,
				sysdate
				)
	</insert>
	<insert id="joinUser" parameterType="User">
		INSERT INTO USER_TB
			   (USER_NUM, USER_ID, USER_PW, USER_FNM, USER_LNM, USER_VERIFY_CODE, USER_REG_DATE)
		VALUES (
				USER_TB001_SEQ.nextval,
				#{user_id},
				#{user_pw},
				#{user_fnm},
				#{user_lnm},
				#{user_verify_code},
				sysdate
				)
	</insert>
	<select id="selectByUserId" resultType="User" parameterType="string">
		SELECT *
		  FROM user_tb
		 WHERE user_id = #{userid}
	</select>
	<select id="selectByUserNum" resultType="User" parameterType="string">
		SELECT *
		  FROM user_tb
		 WHERE user_num = #{usernum}
	</select>
	<update id="email_verify" parameterType="User">
		UPDATE user_tb
		   SET user_email_verify = 1
		 WHERE user_id = #{user_id}
		   AND user_verify_code = #{user_verify_code}
	</update>
	<update id="updatePersonal" parameterType="map">
		UPDATE user_tb
		
		   SET user_fnm 		= #{user_fnm},
		   	   user_lnm			= #{user_lnm},
		   	   user_gender 		= #{user_gender},
		   	   user_birth_date 	= #{user_birth_date}
		   	   
		 WHERE user_num 		= #{user_num}
	</update>
	<update id="passwordChange" parameterType="map">
		UPDATE user_tb
		   SET user_pw 		= #{new_user_pw}
		 WHERE user_num 	= #{user_num}
	</update>
	<select id="getUserInterest" parameterType="string" resultType="map">
		select *
		  from INTEREST_DTB
		 where INTEREST_NUM in (select INTEREST_NUM
                         		  from INTEREST_TB
                        		 where USER_NUM = #{usernum})
	</select>
	<select id="getUserLanguage" parameterType="string" resultType="map">
		select *
 		  from LANGUAGE_DTB
 		 where LANGUAGE_NUM in (select LANGUAGE_NUM
                         		  from LANGUAGE_TB
                       			 where USER_NUM = #{usernum})
	</select>
	<select id="getUserNationality" parameterType="string" resultType="string">
		select NATIONALITY_NAME
		  from NATIONALITY_DTB
		 where NATIONALITY_NUM = (select USER_NATIONALITY
                           			from user_tb
                          		   where user_num = #{usernum})
	</select>
	<select id="getUserCityCountry" parameterType="string" resultType="map">
		select *
		  from CITY_COUNTRY_DTB
		 where CITY_COUNTRY_NUM = (select USER_CITY_COUNTRY
                           			from user_tb
                          		   where user_num = #{usernum})
	</select>
	<select id="getUserGallery" parameterType="string" resultType="map">
		SELECT GALLERY_FILE_NUM, GALLERY_FILE_NAME, GALLERY_PIC_REG_DATE 
		  FROM GALLERY_TB
 		 WHERE user_num = #{usernum}
	</select>
	<select id="getHomeUserList" resultType="map">
		select user_num, user_profile_pic, user_lnm, user_fnm
  		  from user_tb
	</select>
	<update id="setProfilePic" parameterType="map">
		UPDATE user_tb
		   SET USER_PROFILE_PIC	= #{filename}
		 WHERE user_num 		= #{user_num}
	</update>
	<insert id="setGalleryPic" parameterType="map">
		INSERT INTO GALLERY_TB
			   (USER_NUM, GALLERY_FILE_NUM, GALLERY_FILE_NAME, GALLERY_PIC_REG_DATE)
		VALUES (
				#{user_num},
				GALLERY_TB_SEQ.nextval,
				#{filename},
				sysdate
				)
	</insert>
	<delete id="deleteGalleryPic" parameterType="string">
		DELETE
		  FROM gallery_tb
		 WHERE GALLERY_FILE_NUM = #{num} 
	</delete>
	
	<!-- 
		여기서 부터 현길 & 문형
	 -->
	 
	<!-- userNum 으로 사용가능언어 num 불러오기 -->
	<select id="selectUserLanguageNum" parameterType="int" resultType="map">
		select LANGUAGE_NUM as SELECT_NUM
			from LANGUAGE_TB
    		where user_num = #{userNum}
	</select>
	<!-- userNum 으로  interest num 불러오기-->
	<select id="selectUserInterestNum" parameterType="int" resultType="map">
		select INTEREST_NUM as SELECT_NUM
		  from INTEREST_TB
    	 where user_num = #{userNum}
	</select>
	<!-- userNum 으로  tripStyle num 불러오기 -->
	<select id="selectUserTripStyleNum" parameterType="int" resultType="map">
		  select TRAVLE_STYLE_NUM as SELECT_NUM
			from TRAVLE_STYLE_TB
    		where user_num = #{userNum}
	</select>
	<!-- 사용가능언어를  사용가능언어 num 으로 불러오기  화면에 뿌려줄 데이터 미완성-->
	<select id="userUseLanguage" parameterType="int" resultType="map">
		select LANGUAGE_KO_NAME, LANGUAGE_EN_NAME from LANGUAGE_DTB
			where = #{userLanguageNum}
	</select>
	
		<!-- Interest_DTB에서 전부 가져오기 -->
	<select id="getAll_Interest" resultType="map">
		select * from INTEREST_DTB
	</select>
	<select id="getAll_TripStyle" resultType="map">
		select * from TRAVLE_STYLE_DTB
	
	</select>
	<select id="selectAllLanuage" resultType="map">
		select * from LANGUAGE_DTB
	
	</select>
	
	<!-- 사용가능언어 insert/update 하기 -->
	<insert id="insert_Language_tb">
		insert into language_tb (USER_NUM, LANGUAGE_NUM)
			values(#{param2},
					#{param1})
	</insert>
	<delete id="delete_Language_tb" parameterType="int">
		delete language_tb
		 WHERE USER_NUM = #{userNum}
	</delete>
	
	<!-- 좋아하는 것 insert/update 하기 -->
	<insert id="insert_Interest_tb">
		insert into INTEREST_TB (USER_NUM, INTEREST_NUM)
			values(#{param2},
					#{param1})
	</insert>
	<delete id="delete_Interest_tb" parameterType="int">
		delete INTEREST_TB
		 WHERE USER_NUM = #{userNum}
	</delete>
	
	<!-- 여행스타일 insert/update 하기 -->
	<insert id="insert_trip_style_tb">
		insert into TRAVLE_STYLE_TB (USER_NUM, TRAVLE_STYLE_NUM)
			values(#{param2},
					#{param1})
	</insert>
	<delete id="delete_trip_style_tb" parameterType="int">
		delete TRAVLE_STYLE_TB
		 WHERE USER_NUM = #{userNum}
	</delete>
	
	<!-- userIntro update -->
	<update id="user_intro_update" parameterType="map">
		UPDATE user_tb
		   SET USER_INTRO	= #{userIntro}
		WHERE user_num 		= #{userNum} 
	</update>
	<!-- 거주도시 국가 전화번호 업데이트  -->
	<update id="user_city_nation_phoneNumber" parameterType="map">
		UPDATE user_tb
		   SET USER_PHONE_NUM	= #{USER_PHONE_NUM},
		   		USER_NATIONALITY	= #{USER_NATIONALITY},
		   		USER_CITY_COUNTRY	= #{USER_CITY_COUNTRY}
		WHERE user_num 		= #{userNum} 		
	</update>

	<!-- 대시보드 mapper 작성 - 조현길 -->
	<!-- 여행탭 여행 작성글 리스트 호출 -->
	<select id="trip_list" resultType="Map" parameterType="Map">
		select *
		from(
			select rownum as rnum, trip_board_title,trip_board_countent ,trip_writedate, trip_board_readcount, trip_board_key
			from(
				select * from TRIP_BOARD_TB
				where user_num = #{num}
				and trip_board_st = 0
				order by trip_board_key desc
			)
		)
		where rnum between #{firstRow} and #{endRow}
	</select>
	<!-- 토탈 카운트 -->
	<select id="selectTotalCount" resultType="int" parameterType="int">
		select count(*) from TRIP_BOARD_TB
		where user_num = #{num}
	</select>	
	<!-- 여행탭 여행 댓글 리스트 호출 -->
	<select id="trip_reply_list" parameterType="Map" resultType="Map">
<!-- 		select * -->
<!-- 		from( -->
<!-- 			select rownum as rnum, trip_reply_content, trip_reply_writedate -->
<!-- 				from( -->
<!-- 				select * from TRIP_REPLY_TB -->
<!-- 				where user_num = #{num} -->
<!-- 				order by trip_reply_key desc -->
<!-- 			) -->
<!-- 		) -->
<!-- 		where rnum between #{firstRow} and #{endRow} -->
		
		
		select *
		from(
			select rownum as rnum, trip_reply_content, trip_reply_writedate, trip_reply_key, trip_board_key, trip_board_st
			from(
				select reply.trip_reply_content, reply.trip_reply_writedate, reply.trip_reply_key, reply.trip_board_key , board.trip_board_st
				from TRIP_REPLY_TB reply, TRIP_BOARD_TB board
				where reply.trip_board_key = board.trip_board_key
				and reply.user_num = #{num}
				and reply.trip_reply_st = 0
				order by reply.trip_reply_key desc
				)
		)
		where rnum between #{firstRow} and #{endRow}
	</select>
	<select id="selectReplyTotalCount" resultType="int" parameterType="int">
		select count(*) from TRIP_REPLY_TB
		where user_num = #{num}
	</select>	
	<!-- 
		여기 까지 현길 & 문형
	 -->

	<select id="getMotelAvg" parameterType="string" resultType="double">
		select avg(motel_avg)
		from motel_tb
		where user_num = #{usernum}
	</select>
	
	<select id="motelNullCheck" parameterType="string" resultType="map">
		select * from motel_tb where user_num = #{usernum}
	</select>
	
<!-- 	여행파트 dao추가 -->
<select id="getTrStyle" parameterType="String" resultType="map">
select *
from user_tb u join TRAVLE_STYLE_TB t
on u.user_num = t.user_num
where u.user_num = #{userNum}
</select>	

<select id="getTravleHope" parameterType="String" resultType="map">
select *
from user_tb u join TRAVLE_HOPE h
on u.user_num = h.user_num
where u.user_num = #{userNum}
</select>	
	
<select id="getUserRegDate" resultType="map">
<!-- 데이터가 충분치 않아 정렬에 오류가 있을수 있음 -->
SELECT TO_CHAR(USER_REG_DATE,'MM')||'월' as USER_REG_DATE,count(TO_CHAR(USER_REG_DATE,'MM')) as monthCount
FROM user_tb
group by TO_CHAR(USER_REG_DATE,'MM')
order by USER_REG_DATE
</select>	
	
<!-- 	여행파트 dao추가 -->
	<update id="passwordReset" parameterType="map">
		UPDATE user_tb
		   SET user_pw 		= #{reset_pw}
		 WHERE user_id		= #{userid}
	</update>
	
	<!-- 어드민 계정 생성문 -->
	<insert id="setAdmin" parameterType="User">
	INSERT INTO USER_TB
			   (USER_NUM, AUTHORITY, USER_ID, USER_PW, USER_FNM, USER_LNM, USER_EMAIL_VERIFY , USER_REG_DATE)
		VALUES (
				USER_TB001_SEQ.nextval,
				#{authority},
				#{user_id},
				#{user_pw},
				#{user_fnm},
				#{user_lnm},
				1,
				sysdate
				)
	</insert>
</mapper>