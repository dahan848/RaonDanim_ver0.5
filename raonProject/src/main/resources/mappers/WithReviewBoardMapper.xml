<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper     
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.raon.raondanim.dao.WithReviewBoardDao">
	
	
	
	<select id="selectAll" resultType="map">
<!-- 		SELECT 	r.WITH_NUM, -->
<!-- 				r.USER_NUM, -->
<!-- 				r.WITH_CONTENT, -->
<!-- 				r.WITH_GPA, -->
<!-- 				r.WITH_COUNT, -->
<!-- 				r.WITH_REG_DATE, -->
<!-- 				r.RE_COUNT, -->
<!-- 				r.WITH_ST, -->
<!-- 				r.WITH_AVG, -->
<!-- 				u.USER_NUM, -->
<!-- 				u.USER_ID, -->
<!-- 				u.USER_FNM, -->
<!-- 				u.USER_LNM, -->
<!-- 				u.USER_NATIONALITY, -->
<!-- 				u.USER_NATION, -->
<!-- 				u.USER_CITY, -->
<!-- 				u.USER_GENDER, -->
<!-- 				u.USER_PROFILE_PIC, -->
<!-- 				u.USER_WITH_AVG, -->
<!-- 				u.USER_MOTEL_AVG, -->
<!-- 				u.USER_ID, -->
<!-- 				u.USER_PW -->
<!-- 		  FROM 	WITH_BOARD_TB r left outer join USER_TB u -->
<!-- 		    ON  r.USER_NUM = u.USER_NUM -->
<!-- 		 ORDER BY USER_NUM DESC -->
		SELECT * 
		  FROM USER_TB
		  order by USER_NUM desc
	</select>
	
	
	
	<insert id="insertWith" parameterType="map">
		<selectKey order="BEFORE" keyProperty="NUM" resultType="int">
			select WITH_BOARD_TB_SEQ.nextval from dual
		</selectKey>
		INSERT
		  INTO WITH_BOARD_TB
			  (	WITH_NUM, 
			  	USER_NUM, 
			  	WITH_CONTENT, 
			  	WITH_GPA, 
			  	WITH_COUNT, 
			  	WITH_REG_DATE, 
			  	WITH_ST, 
			  	WITH_AVG)
		VALUES (#{NUM}, #{USER_NUM}, #{WITH_CONTENT}, #{WITH_GPA}, 0, SYSDATE, 0, 0)
	</insert>
	
	
	
	<update id="updateWith" parameterType="map">
		UPDATE 		WITH_BOARD_TB
		   SET 		WITH_CONTENT = #{REV_TITLE},
					WITH_GPA = #{REV_DESTINATION}
		WHERE 		WITH_NUM = #{NUM}
	</update>
	
	
	
	<delete id="deleteWith" parameterType="int">
		DELETE
		  FROM 	WITH_BOARD_TB
		 WHERE 	WITH_NUM = #{NUM}
	</delete>
	
	
	
	<select id="selectOne" parameterType="int" resultMap="reviewMap">
		SELECT 	r.WITH_NUM,
				r.USER_NUM,
				r.WITH_CONTENT,
				r.WITH_GPA,
				r.WITH_COUNT,
				r.WITH_REG_DATE,
				r.WITH_ST,
				r.WITH_AVG,
				u.USER_NUM,
				u.USER_ID,
				u.USER_FNM,
				u.USER_LNM,
				u.USER_NATIONALITY,
				u.USER_NATION,
				u.USER_CITY,
				u.USER_GENDER,
				u.USER_PROFILE_PIC,
				u.USER_WITH_AVG,
				u.USER_MOTEL_AVG,
				u.USER_ID,
				u.USER_PW
		  FROM 	WITH_BOARD_TB r left outer join USER_TB u
		    ON  r.USER_NUM = u.USER_NUM
		 WHERE  r.USER_NUM = #{USER_NUM}
	</select>
	<resultMap type="HashMap" id="reviewMap">
		<result property="WITH_CONTENT" column="WITH_CONTENT" jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>
	
	
	<select id="selectWithOne" parameterType="int" resultMap="reviewViewMap">
		SELECT 	r.WITH_NUM,
				r.USER_NUM,
				r.WITH_CONTENT,
				r.WITH_GPA,
				r.WITH_COUNT,
				r.WITH_REG_DATE,
				r.WITH_ST,
				r.WITH_AVG,
				u.USER_NUM,
				u.USER_ID,
				u.USER_FNM,
				u.USER_LNM,
				u.USER_NATIONALITY,
				u.USER_NATION,
				u.USER_CITY,
				u.USER_GENDER,
				u.USER_PROFILE_PIC,
				u.USER_WITH_AVG,
				u.USER_MOTEL_AVG,
				u.USER_ID,
				u.USER_PW
		  FROM 	USER_TB u left outer join WITH_BOARD_TB r 
		    ON  r.USER_NUM = u.USER_NUM
		 WHERE  u.USER_NUM = #{USER_NUM}
	</select>
	<resultMap type="HashMap" id="reviewViewMap">
		<result property="WITH_CONTENT" column="WITH_CONTENT" jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>
	
	<update id="plusReadCount" parameterType="int">
		UPDATE 		WITH_BOARD_TB
		   SET 		WITH_COUNT = WITH_COUNT + 1
		 WHERE 		WITH_NUM = #{NUM}
	</update>
	
	
	
	<select id="selectByUserNum" parameterType="int" resultType="map">
		SELECT *
		  FROM WITH_BOARD_TB
		 WHERE USER_NUM = #{USER_NUM}
	</select>
	
	
	
</mapper>