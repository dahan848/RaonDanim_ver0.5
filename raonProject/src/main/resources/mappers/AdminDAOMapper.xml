<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper     
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.raon.raondanim.dao.AdminDAO">
	<!-- 계정잠금 상태 유저 목록 -->
	<select id="getLockoutUserList" resultType="map">
		SELECT user_id, user_lnm, user_fnm, user_reg_date ,user_last_try_login_time, user_num
		  FROM user_tb 
		 WHERE enabled = 0
	</select>
	
	<!-- 비활성화 계정 활성화 시키는 () -->
	<update id="userUnlock" parameterType="int">
		UPDATE user_tb
  		   SET enabled = 1
  		 WHERE user_num = #{usernum}
	</update>
	
	<!-- 문의글 DB에 인서트 -->
	<insert id="insertInquiry" parameterType="map">
		INSERT INTO INQUIRY_TB
			   (INQUIRY_NUM, INQUIRY_TYPE, INQUIRY_RGE_TYPE, INQUIRY_REG_ID, INQUIRY_SUBJECT, INQUIRY_CONTENT)
		VALUES (
				INQUIRY_TB_SEQ.nextval,
				#{inquiry_type},
				#{inquiry_rge_type},
				#{inquiry_reg_id},
				#{inquiry_subject},
				#{inquiry_content}
				)
	</insert>
	<!-- 페이징 처리를 위한 총 문의글 개수 구하기 -->
	<select id="selectInquiryTotalCount" parameterType="map" resultType="int">
        select count(*)
        from INQUIRY_TB
        WHERE 1 = 0
		        		<if test="type == 0">
           					OR 1=1
       					</if>
						<if test="type == 1">
           					OR INQUIRY_TYPE = 0
       					</if>
  							<if test="type == 2">
           					OR INQUIRY_TYPE = 1
       					</if>
       					<if test="type == 3">
           					OR INQUIRY_TYPE = 2
       					</if>
      						<if test="type == 4">
           					OR INQUIRY_ANSWER_ST = 0 
       					</if>
    </select>
    <!-- 조건에 따른 문의글 목록 반환 -->
	<select id="InquiryList" parameterType="map" resultType="map">
	  SELECT *
        FROM (SELECT ROWNUM as RNUM,INQUIRY_NUM,INQUIRY_TYPE,INQUIRY_REG_ID,INQUIRY_SUBJECT,INQUIRY_CONTENT,INQUIRY_REG_DATE,INQUIRY_RGE_TYPE,ANSWER_ST, ANSWER_NUM
                FROM (SELECT i.INQUIRY_NUM,i.INQUIRY_TYPE,i.INQUIRY_REG_ID,i.INQUIRY_SUBJECT,i.INQUIRY_CONTENT,i.INQUIRY_REG_DATE,i.INQUIRY_RGE_TYPE, a.ANSWER_NUM ,count(a.ANSWER_NUM) as ANSWER_ST
                        FROM INQUIRY_TB i left outer join ANSWER_TB a
                          ON i.INQUIRY_NUM = a.INQUIRY_NUM
                       WHERE 1 = 0
			        		<if test="type == 0">
            					OR 1=1
        					</if>
							<if test="type == 1">
            					OR i.INQUIRY_TYPE = 0
        					</if>
   							<if test="type == 2">
            					OR i.INQUIRY_TYPE = 1
        					</if>
        					<if test="type == 3">
            					OR i.INQUIRY_TYPE = 2
        					</if>
       						<if test="type == 4">
            					OR a.ANSWER_NUM is null
        					</if>
                        GROUP BY i.INQUIRY_NUM,i.INQUIRY_TYPE,i.INQUIRY_REG_ID,i.INQUIRY_SUBJECT,i.INQUIRY_CONTENT,i.INQUIRY_REG_DATE,i.INQUIRY_RGE_TYPE,a.ANSWER_NUM
                        ORDER BY i.INQUIRY_NUM))
        WHERE RNUM between #{firstRow} and #{endRow}
	</select>
	<!-- 문의글 더미 데이터 생성 -->
	<insert id="insertDummyInquiry" parameterType="map">
		INSERT INTO INQUIRY_TB
			   (INQUIRY_NUM, INQUIRY_TYPE, INQUIRY_RGE_TYPE, INQUIRY_REG_ID, INQUIRY_SUBJECT, INQUIRY_CONTENT)
		VALUES (
				INQUIRY_TB_SEQ.nextval,
				#{inquiry_type},
				#{inquiry_rge_type},
				#{inquiry_reg_id},
				#{inquiry_subject},
				#{inquiry_content}
				)
	</insert>
	<!-- DB에 답변 집어넣기 -->
		<insert id="insertAnswer" parameterType="map">
		INSERT INTO ANSWER_TB
			   (ANSWER_NUM, INQUIRY_NUM, ANSWER_CONTENT)
		VALUES (
				ANSWER_TB_SEQ.nextval,
				#{inquiry_num},
				#{content}
				)
	</insert>
	<!-- 답변 상태 업데이트 -->
	<update id="updateInquiryAnswer" parameterType="string">
		UPDATE INQUIRY_TB
  		   SET INQUIRY_ANSWER_ST = 1
  		 WHERE INQUIRY_NUM = #{INQUIRY_NUM}
	</update>
	<!-- 문의글 선택 -->
	<select id="selectInquiry" parameterType="string" resultType="map">
		SELECT INQUIRY_REG_ID, INQUIRY_SUBJECT, INQUIRY_CONTENT, INQUIRY_REG_DATE
  		  FROM INQUIRY_TB
  		 WHERE INQUIRY_NUM = #{INQUIRY_NUM}
	</select>
</mapper>